<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.237">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Dynamic Pricing - 톰슨 샘플링</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="site_libs/quarto-contrib/glightbox/glightbox.min.js"></script>
<link href="site_libs/quarto-contrib/glightbox/glightbox.min.css" rel="stylesheet">
<link href="site_libs/quarto-contrib/glightbox/lightbox.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>

  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Dynamic Pricing</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./background.html">
 <span class="menu-text">Part 0</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-i---r" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part I - R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-i---r">    
        <li>
    <a class="dropdown-item" href="./pricing.html">
 <span class="dropdown-text">가격결정 중요성</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./demand_curve.html">
 <span class="dropdown-text">(통계)수요곡선</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./price_opt.html">
 <span class="dropdown-text">가격변동과 최적화</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./cvp.html">
 <span class="dropdown-text">[외전] CVP 분석</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-ii---r" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part II - R</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-ii---r">    
        <li>
    <a class="dropdown-item" href="./ab_testing.html">
 <span class="dropdown-text">A/B Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./bayesian.html">
 <span class="dropdown-text">(베이지안) 통계</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./thompson.html">
 <span class="dropdown-text">톰슨 샘플링</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-i---py" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part I - Py</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-i---py">    
        <li>
    <a class="dropdown-item" href="./pricing.html">
 <span class="dropdown-text">가격결정 중요성</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./py_demand_curve.html">
 <span class="dropdown-text">(통계)수요곡선</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-part-ii---py" role="button" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Part II - Py</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-part-ii---py">    
        <li>
    <a class="dropdown-item" href="./py_ab_testing.html">
 <span class="dropdown-text">A/B Testing</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="./py_bayesian.html">
 <span class="dropdown-text">(베이지안) 통계</span></a>
  </li>  
    </ul>
  </li>
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">목차</h2>
   
  <ul>
  <li><a href="#가격-탐색과-활용" id="toc-가격-탐색과-활용" class="nav-link active" data-scroll-target="#가격-탐색과-활용"><span class="toc-section-number">1</span>  가격 탐색과 활용</a></li>
  <li><a href="#가격과-매출" id="toc-가격과-매출" class="nav-link" data-scroll-target="#가격과-매출"><span class="toc-section-number">2</span>  가격과 매출</a>
  <ul class="collapse">
  <li><a href="#수요-확률분포" id="toc-수요-확률분포" class="nav-link" data-scroll-target="#수요-확률분포"><span class="toc-section-number">2.1</span>  수요 확률분포</a></li>
  <li><a href="#가격별-커피-판매량" id="toc-가격별-커피-판매량" class="nav-link" data-scroll-target="#가격별-커피-판매량"><span class="toc-section-number">2.2</span>  가격별 커피 판매량</a></li>
  <li><a href="#가격별-매출확률분포" id="toc-가격별-매출확률분포" class="nav-link" data-scroll-target="#가격별-매출확률분포"><span class="toc-section-number">2.3</span>  가격별 매출확률분포</a></li>
  </ul></li>
  <li><a href="#톰슨-샘플링" id="toc-톰슨-샘플링" class="nav-link" data-scroll-target="#톰슨-샘플링"><span class="toc-section-number">3</span>  톰슨 샘플링</a>
  <ul class="collapse">
  <li><a href="#최고의-맛집" id="toc-최고의-맛집" class="nav-link" data-scroll-target="#최고의-맛집"><span class="toc-section-number">3.1</span>  최고의 맛집</a></li>
  <li><a href="#커피집-선정과정" id="toc-커피집-선정과정" class="nav-link" data-scroll-target="#커피집-선정과정"><span class="toc-section-number">3.2</span>  커피집 선정과정</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title">톰슨 샘플링</h1><button type="button" class="btn code-tools-button dropdown-toggle" id="quarto-code-tools-menu" data-bs-toggle="dropdown" aria-expanded="false"><i class="bi"></i> Code</button><ul class="dropdown-menu dropdown-menu-end" aria-labelelledby="quarto-code-tools-menu"><li><a id="quarto-show-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Show All Code</a></li><li><a id="quarto-hide-all-code" class="dropdown-item" href="javascript:void(0)" role="button">Hide All Code</a></li><li><hr class="dropdown-divider"></li><li><a id="quarto-view-source" class="dropdown-item" href="javascript:void(0)" role="button">View Source</a></li></ul></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="가격-탐색과-활용" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> 가격 탐색과 활용</h1>
<p>사업목표를 달성할 수 있는 가격을 정해야하는데 문제는 적정 가격이 얼마인지 알 수 없다는 점이다. 사업과 과학기술 연구개발은 목적이 다르기 때문에 사업목표를 달성하는 가장 큰 기여를 하는 가격을 책정한 후에 특정된 가격을 실제 사업에 반영하여 매출 혹은 순익, 고객유지율 등 당면한 문제해결에 기여해야 한다.</p>
<p>이와 같은 상황에 최적 가격을 <strong>탐색(Explore)</strong>하는 과정과 특정된 가격을 <strong>최대한 활용(Exploit)</strong>하여 사업목표를 극대화해야만 된다.</p>
</section>
<section id="가격과-매출" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> 가격과 매출</h1>
<p>앞서 학습한 커피가격에 판매는 고정된 함수관계가 아니고 수요는 경기, 물가, 건강, 소득 등 다양한 요인에 따라 다양한 형태를 갖는 확률분포를 따르게 된다. 가격 변화에 따른 수요를 정규분포를 가정하면 모의시험을 통해 즉, 난수를 생성시켜 매출도 예측할 수 있다.</p>
<section id="수요-확률분포" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="수요-확률분포"><span class="header-section-number">2.1</span> 수요 확률분포</h2>
<p>수요변화를 정규분포를 가정하고 모형을 세우면 다음과 같은 모습이 될 것이다. 즉, 수요는 가격에 따라 특정 수요량으로 고정된 것이 아니라 앞서 언급한 사회경제, 주변 경쟁업체 수, 다양한 가격정책 등에 따라 수요는 변동성을 갖게 된다. 평균</p>
<div class="cell">
<details>
<summary>코드 보기</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Attaching packages ─────────────────────────────────────── tidyverse 1.3.1 ──</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ ggplot2 3.3.6      ✔ purrr   0.3.4 </span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ tibble  3.1.8      ✔ dplyr   1.0.10</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ tidyr   1.2.1      ✔ stringr 1.4.1 </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✔ readr   2.1.2      ✔ forcats 0.5.2</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: 패키지 'tibble'는 R 버전 4.2.1에서 작성되었습니다</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: 패키지 'tidyr'는 R 버전 4.2.1에서 작성되었습니다</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: 패키지 'dplyr'는 R 버전 4.2.1에서 작성되었습니다</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: 패키지 'stringr'는 R 버전 4.2.1에서 작성되었습니다</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: 패키지 'forcats'는 R 버전 4.2.1에서 작성되었습니다</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::filter() masks stats::filter()</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; ✖ dplyr::lag()    masks stats::lag()</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. 데이터 -------------</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span><span class="st">"가격"</span>, <span class="sc">~</span><span class="st">"수요"</span>,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">1000</span>, <span class="dv">120</span>,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">2000</span>, <span class="dv">80</span>,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">3000</span>, <span class="dv">40</span>,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">4000</span>, <span class="dv">20</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. 정규분포 -------------</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">180</span>)), <span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 1,000원 ------</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">120</span>, <span class="at">sd =</span> <span class="dv">15</span>)) <span class="sc">+</span> </span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">120</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>) <span class="sc">+</span>  </span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 2,000원 ------</span></span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">80</span>, <span class="at">sd =</span> <span class="dv">10</span>), <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">80</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span>  </span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 3,000원 ------  </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">40</span>, <span class="at">sd =</span> <span class="dv">7</span>), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">40</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  </span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 4,000원 ------  </span></span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">5</span>), <span class="at">color=</span><span class="st">"orange"</span>) <span class="sc">+</span>  </span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">20</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span>  </span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"가격별 예상판매 커피수 확률분포"</span>,</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"커피 판매량 (단위: 컵)"</span>,</span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">120</span>, <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"1천원"</span>), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">80</span>,  <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"2천원"</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">40</span>,  <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"3천원"</span>), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">20</span>,  <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"4천원"</span>), <span class="at">color =</span> <span class="st">"orange"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="thompson_files/figure-html/unnamed-chunk-1-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-1"><img src="thompson_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="가격별-커피-판매량" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="가격별-커피-판매량"><span class="header-section-number">2.2</span> 가격별 커피 판매량</h2>
<p>가격 변동에 따라 매출이 어떻게 변화하게 되는지 각 분포에서 난수를 추출하여 모의실험을 수행해보자.</p>
<p><span class="math display">\[ X_{\text{커피 판매량}} \sim \mathcal{N}(\mu,\,\sigma^{2})\]</span></p>
<ul>
<li><span class="math inline">\(X_{\text{1천원}} \sim \mathcal{N}(120,\, 15^{2})\)</span></li>
<li><span class="math inline">\(X_{\text{2천원}} \sim \mathcal{N}(80, \, 10^{2})\)</span></li>
<li><span class="math inline">\(X_{\text{3천원}} \sim \mathcal{N}(40, \, 7^{2})\)</span></li>
<li><span class="math inline">\(X_{\text{4천원}} \sim \mathcal{N}(20, \, 5^{2})\)</span></li>
</ul>
<p>상기 4가지 가격정책에 대해 1,000개 난수를 추출하여 판매량을 예측해본다.</p>
<div class="cell">
<details>
<summary>코드 보기</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>coffee_quantity <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span><span class="st">"mean"</span>, <span class="sc">~</span><span class="st">"sd"</span>,</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>        <span class="dv">120</span>, <span class="dv">15</span>,</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>        <span class="dv">80</span>, <span class="dv">10</span>,</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>        <span class="dv">40</span>, <span class="dv">7</span>,</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>        <span class="dv">20</span>, <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price =</span> <span class="fu">case_when</span>(mean <span class="sc">==</span> <span class="dv">120</span> <span class="sc">~</span> <span class="st">"1천원"</span>,</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">80</span> <span class="sc">~</span> <span class="st">"2천원"</span>,</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">40</span> <span class="sc">~</span> <span class="st">"3천원"</span>,</span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">20</span> <span class="sc">~</span> <span class="st">"4천원"</span>))</span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data <span class="ot">&lt;-</span> coffee_quantity <span class="sc">%&gt;%</span> </span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(판매량 <span class="ot">=</span> <span class="fu">map2</span>(mean, sd, rnorm, <span class="at">n =</span> <span class="dv">1000</span>) )</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 × 4</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    mean    sd price 판매량       </span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;list&gt;       </span></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   120    15 1천원 &lt;dbl [1,000]&gt;</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    80    10 2천원 &lt;dbl [1,000]&gt;</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    40     7 3천원 &lt;dbl [1,000]&gt;</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4    20     5 4천원 &lt;dbl [1,000]&gt;</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data <span class="sc">%&gt;%</span> </span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(판매량) <span class="sc">%&gt;%</span> </span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> 판매량, <span class="at">fill =</span> <span class="fu">fct_rev</span>(price))) <span class="sc">+</span></span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"가격별 예상판매 모의 커피수"</span>,</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"커피 판매량 (단위: 컵)"</span>,</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"커피가격"</span>) <span class="sc">+</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="thompson_files/figure-html/unnamed-chunk-2-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-2"><img src="thompson_files/figure-html/unnamed-chunk-2-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
<section id="가격별-매출확률분포" class="level2" data-number="2.3">
<h2 data-number="2.3" class="anchored" data-anchor-id="가격별-매출확률분포"><span class="header-section-number">2.3</span> 가격별 매출확률분포</h2>
<p>가격 변화에 따라 판매량이 가격민감도에 따라 차이가 나기 때문에 모의시험을 통해 매출변화를 살펴보면 커피값 2,000원에서 가장 높은 매출이 나타났다. 가격이 4,000원일 때 상대적으로 낮은 매출이 나왔으며 2,000/3,000원에서는 대략 유사한 매출이 관측됐다.</p>
<div class="cell">
<details>
<summary>코드 보기</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data <span class="sc">%&gt;%</span> </span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(판매량) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(가격 <span class="ot">=</span> <span class="fu">case_when</span>(mean <span class="sc">==</span> <span class="dv">120</span> <span class="sc">~</span> <span class="dv">1000</span>,</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">80</span> <span class="sc">~</span> <span class="dv">2000</span>,</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">40</span> <span class="sc">~</span> <span class="dv">3000</span>,</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">20</span> <span class="sc">~</span> <span class="dv">4000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(매출 <span class="ot">=</span> 가격 <span class="sc">*</span> 판매량 <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> 매출, <span class="at">fill =</span> <span class="fu">as.factor</span>(가격))) <span class="sc">+</span></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"일일 가격별 예상매출 모의시험 결과"</span>,</span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"커피 매출 (단위: 만원)"</span>,</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"커피가격"</span>) <span class="sc">+</span></span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="thompson_files/figure-html/unnamed-chunk-3-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-3"><img src="thompson_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="톰슨-샘플링" class="level1 page-columns page-full" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> 톰슨 샘플링</h1>
<p>톰슨 샘플링(Thompson sampling)은 1933년 톰슨이 최초 기술되었으나 Multi-Armed Bandit 문제를 통해 다시 부각되기 시작했다.</p>
<p>서로 다른 가격정책을 취하는 커피점 3개가 있다고 가정하자. 커피 만족도는 다양한 요인이 고객의 만족도에 영향을 준다. 대체로 커피점 C가 만족도가 가장 높은 것으로 나오나 일자별로 살펴보면 평균적으로 A커피점이 B커피점 보다 낮은 만족도를 주고 있으나 날씨, 매장 상황 등 여러 요인으로 인해 A커피점이 B커피점보다 더 높은 만족도를 주는 경우도 있다.</p>
<p>커피점 3 곳에 경쟁하고 있고 각 커피점이 주는 고객 만족도가 서로 다른 확률분포를 따른다고 가정했을 때 처음 이사를 온 김모씨는 처음 몇일 동안 탐색기간을 가지게 되고 어느 정도 탐색기간이 끝나게 되면 더이상의 탐색은 하지 않고 김모씨 본인의 효용을 극대화하기 위해 특정 커피점만 이용하는 행태를 갖게 된다. 이를 시각적으로 표현하면 다음과 같다.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/thompson-sampling.png" class="lightbox" data-gallery="quarto-lightbox-gallery-4"><img src="images/thompson-sampling.png" class="img-fluid figure-img"></a></p>
</figure>
</div>
<section id="최고의-맛집" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="최고의-맛집"><span class="header-section-number">3.1</span> 최고의 맛집</h2>
<p>커피집 3곳에 동시에 오픈을 했는데 100명이 커피집을 골고루 방문한 후에 만족한 고객숫자와 불만족한 고객숫자를 다음과 같이 설정하고 10 영업일 기준 최고맛집을 선정할 수 있다. 먼저 베타분포에서 각 커피점 방문 고객 만족자수와 불만족 고객수를 형태모수로 넣어 10 영업일 기준 최고의 맛집을 선정한다.</p>
<div class="cell">
<details>
<summary>코드 보기</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피점 방문 숫자</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>beta_visits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피집 만족 고객수</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>beta_success <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">15</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피집 불만족 고객수</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>beta_failure <span class="ot">&lt;-</span> beta_visits <span class="sc">-</span> beta_success</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>num_shops <span class="ot">&lt;-</span> <span class="fu">length</span>(beta_visits)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 영업일수</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>num_days <span class="ot">&lt;-</span> <span class="dv">10</span> </span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 베타분포 (성공, 실패) 하루 영업일</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>one_day_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"A커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">1</span>]),</span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"B커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">2</span>]),</span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"C커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">3</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">3</span>]))</span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble(beta_success, beta_failure) %&gt;% </span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(data = map2_dbl(beta_success, beta_failure, rbeta, n=1))</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 베타분포 (성공, 실패) N 영업일</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_days) {</span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  one_day_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"A커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">1</span>]),</span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"B커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">2</span>]),</span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"C커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">3</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">3</span>]))</span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a>  coffee_tbl <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coffee_tbl, one_day_tbl)</span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피집 선정</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(오늘의맛집 <span class="ot">=</span> <span class="fu">max.col</span>(coffee_tbl)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(오늘의맛집 <span class="ot">=</span> <span class="fu">factor</span>(오늘의맛집, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A커피점"</span>, <span class="st">"B커피점"</span>, <span class="st">"C커피점"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(오늘의맛집) <span class="sc">%&gt;%</span> </span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(선정횟수 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(선정비율 <span class="ot">=</span> 선정횟수 <span class="sc">/</span> <span class="fu">sum</span>(선정횟수))</span>
<span id="cb4-40"><a href="#cb4-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb4-41"><a href="#cb4-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   오늘의맛집 선정횟수 선정비율</span></span>
<span id="cb4-42"><a href="#cb4-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;         &lt;int&gt;    &lt;dbl&gt;</span></span>
<span id="cb4-43"><a href="#cb4-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 A커피점           2      0.2</span></span>
<span id="cb4-44"><a href="#cb4-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 B커피점           4      0.4</span></span>
<span id="cb4-45"><a href="#cb4-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 C커피점           4      0.4</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="커피집-선정과정" class="level2 page-columns page-full" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="커피집-선정과정"><span class="header-section-number">3.2</span> 커피집 선정과정</h2>
<p>톰슨 샘플링을 통해 커피집 선정과 가격결정 등 주요 의사결정에 있어 장점은 자기수정기능이 있다는 점이다. 예를 들어, 매월 커피집 선정과 가격절정 등 수집된 실증 사업데이터를 자동갱신하여 사업을 계속할 수 있다.</p>
<p>예를 들어, 다음과 같이 서로 다른 세가지 특성(다른 조건은 동일하고 가격이 다소 다른 커피집)을 갖는 취하는 커피집이 있다고 하면 미세한 차이가 나지만 이러한 작은 차이가 매월매월 지나면서 방문자수에서 차이가 나고 사업의 성패를 좌우하게 됩니다.</p>
<p>베르누이 밴딧을 상정하고 톰슨 샘플링을 구현한 의사코드는 다음과 같다. 형태모수 <span class="math inline">\(\alpha, \beta\)</span>를 베타분포에서 보통 <span class="math inline">\(\alpha=1, \beta=1\)</span>로 지정하여 균등분포로 두고 성공과 실패를 고객의 방문, 온라인광고의 경우 노출시 클릭여부로 두고 알고리즘 전반을 설정한다. 그리고 나서 K개 커피집(여기서는 3개)에 대해 T명 지나가는 행인(여기서는 100명)을 반복하는 난수를 베타분포에서 추출한다. 이후 가장 많은 방문을 갖는 커피집을 선정하고 나서 성공과 실패를 갱신한다.</p>
<div class="page-columns page-full"><p></p><div class="no-row-height column-margin column-container"><span class="">의사 알고리즘 이미지 출처: <a href="https://tech.kakao.com/2021/06/25/kakao-ai-recommendation-01/">카카오 AI추천 : 토픽 모델링과 MAB를 이용한 카카오 개인화 추천</a></span></div></div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="images/thompson_pseudo_code.png" class="lightbox" data-gallery="quarto-lightbox-gallery-5" title="톰슨 샘플링 의사코드"><img src="images/thompson_pseudo_code.png" class="img-fluid figure-img"></a></p>
<p></p><figcaption class="figure-caption">톰슨 샘플링 의사코드</figcaption><p></p>
</figure>
</div>
<div class="cell">
<details>
<summary>코드 보기</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">77777</span>)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 설정 --------------------</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="ot">&lt;-</span> {}</span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>success_prob <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.11</span>, <span class="fl">0.15</span>)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>beta_visits  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(success_prob))</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>beta_success <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(success_prob))</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>num_shops  <span class="ot">&lt;-</span> <span class="fu">length</span>(success_prob)</span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>visits_size <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="do">## 1개월 영업 -------------------</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>get_monthly_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(beta_visits, beta_success) {</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  monthly_coffee <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 영업일 100명 기준 일별 커피집 방문</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 고객 커피집 선택 난수생성</span></span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a>    user_prob_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(beta_success, beta_visits) <span class="sc">%&gt;%</span></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">beta_failure =</span> beta_visits <span class="sc">-</span> beta_success) <span class="sc">%&gt;%</span> </span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2_dbl</span>(beta_success<span class="sc">+</span><span class="dv">1</span>, beta_failure<span class="sc">+</span><span class="dv">1</span>, rbeta, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">ifelse</span>(<span class="fu">is.finite</span>(data), data, <span class="dv">0</span> )) <span class="sc">%&gt;%</span></span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">shops =</span> <span class="fu">c</span>(<span class="st">"A커피집"</span>, <span class="st">"B커피집"</span>, <span class="st">"C커피집"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(shops, data) <span class="sc">%&gt;%</span> </span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> shops, <span class="at">values_from =</span> data, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>    monthly_coffee <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(monthly_coffee, user_prob_tbl)</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>  <span class="co"># daily_coffee</span></span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 영업일 100명 기준 방문 실적 업데이트</span></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>  updated_prob <span class="ot">&lt;-</span> monthly_coffee <span class="sc">%&gt;%</span> </span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(오늘의맛집 <span class="ot">=</span> <span class="fu">max.col</span>(monthly_coffee)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mutate(오늘의맛집 = factor(오늘의맛집, </span></span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                       labels = c("A커피점", "B커피점", "C커피점"))) %&gt;% </span></span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(오늘의맛집) <span class="sc">%&gt;%</span> </span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(선정횟수 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(선정확률 <span class="ot">=</span> 선정횟수 <span class="sc">/</span> <span class="fu">sum</span>(선정횟수, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(선정확률)</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>  updated_prob</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a><span class="fu">get_monthly_prob</span>(beta_success, beta_visits)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a><span class="do">## 12개월 영업 -------------------</span></span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { <span class="co"># 12개월</span></span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 매월 커피집 방문 확률 반영</span></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>  updated_prob <span class="ot">&lt;-</span> <span class="fu">get_monthly_prob</span>(beta_visits, beta_success)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 월별 가중치 변경</span></span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">round</span>(updated_prob <span class="sc">*</span> visits_size, <span class="dv">0</span>)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 커피구매 고객수 수정 반영</span></span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a>  beta_success <span class="ot">&lt;-</span> beta_success <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="fu">rep</span>(<span class="dv">1</span>, num_shops), <span class="at">size =</span> weights,</span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prob =</span> success_prob)</span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 전체 고객 방문고객수 반영</span></span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>  beta_visits <span class="ot">&lt;-</span> beta_visits <span class="sc">+</span> weights</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 월별 커피집 방문확률 누적</span></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>  coffee_tbl <span class="ot">&lt;-</span> <span class="fu">rbind</span>(coffee_tbl, <span class="fu">t</span>(<span class="fu">matrix</span>(updated_prob)))</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="ot">&lt;-</span> coffee_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"A커피점"</span>, <span class="st">"B커피점"</span>, <span class="st">"C커피점"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(월별 <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>월별, <span class="at">names_to =</span> <span class="st">"커피점"</span>, <span class="at">values_to =</span> <span class="st">"방문확률"</span>)</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="sc">%&gt;%</span> </span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"data/coffee_tbl_rds.rds"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<p>상기 커피집 방문확률을 월별로 나눠 쭉 지켜보게 되면 다음과 같이 처음에는 A, B 커피집이 우세하지만 시간이 지나면서 고객은 C 커피집 선택이 확대되는 것을 확인할 수 있다.</p>
<div class="cell">
<details>
<summary>코드 보기</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="ot">&lt;-</span> </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_rds</span>(<span class="st">"data/coffee_tbl_rds.rds"</span>)</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="sc">%&gt;%</span> </span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(월별), <span class="at">y =</span> 방문확률, <span class="at">fill =</span> 커피점)) <span class="sc">+</span> </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"월"</span>,</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"월별 고객 커피점 방문확률 예측"</span>) <span class="sc">+</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><a href="thompson_files/figure-html/unnamed-chunk-6-1.png" class="lightbox" data-gallery="quarto-lightbox-gallery-6"><img src="thompson_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></a></p>
</figure>
</div>
</div>
</div>


<!-- -->

</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><div class="modal fade" id="quarto-embedded-source-code-modal" tabindex="-1" aria-labelledby="quarto-embedded-source-code-modal-label" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable"><div class="modal-content"><div class="modal-header"><h5 class="modal-title" id="quarto-embedded-source-code-modal-label">Source Code</h5><button class="btn-close" data-bs-dismiss="modal"></button></div><div class="modal-body"><div class="">
<div class="sourceCode" id="cb7" data-shortcodes="false"><pre class="sourceCode markdown code-with-copy"><code class="sourceCode markdown"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="an">title:</span><span class="co"> "톰슨 샘플링"</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="an">filters:</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co">   - lightbox</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a><span class="an">lightbox:</span><span class="co"> auto</span></span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a><span class="an">editor_options:</span><span class="co"> </span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a><span class="co">  chunk_output_type: console</span></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a><span class="an">knitr:</span></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co">  opts_chunk: </span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a><span class="co">    echo: true</span></span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a><span class="co">    waring: false</span></span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a><span class="co">    collapse: true</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a><span class="co">    comment: "#&gt;"</span></span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a><span class="co">---</span></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a><span class="fu"># 가격 탐색과 활용</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>사업목표를 달성할 수 있는 가격을 정해야하는데 문제는 적정 가격이 얼마인지 알 수 없다는 점이다. 사업과 과학기술 연구개발은 목적이 다르기 때문에 사업목표를 달성하는 가장 큰 기여를 하는 가격을 책정한 후에 특정된 가격을 실제 사업에 반영하여 매출 혹은 순익, 고객유지율 등 당면한 문제해결에 기여해야 한다.</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>이와 같은 상황에 최적 가격을 **탐색(Explore)**하는 과정과 특정된 가격을 **최대한 활용(Exploit)**하여 사업목표를 극대화해야만 된다.</span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a><span class="fu"># 가격과 매출</span></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>앞서 학습한 커피가격에 판매는 고정된 함수관계가 아니고 수요는 경기, 물가, 건강, 소득 등 다양한 요인에 따라 다양한 형태를 갖는 확률분포를 따르게 된다. 가격 변화에 따른 수요를 정규분포를 가정하면 모의시험을 통해 즉, 난수를 생성시켜 매출도 예측할 수 있다.</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a><span class="fu">## 수요 확률분포</span></span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a>수요변화를 정규분포를 가정하고 모형을 세우면 다음과 같은 모습이 될 것이다. 즉, 수요는 가격에 따라 특정 수요량으로 고정된 것이 아니라 앞서 언급한 사회경제, 주변 경쟁업체 수, 다양한 가격정책 등에 따라 수요는 변동성을 갖게 된다.</span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>평균 </span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a><span class="do">## 1. 데이터 -------------</span></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span><span class="st">"가격"</span>, <span class="sc">~</span><span class="st">"수요"</span>,</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">1000</span>, <span class="dv">120</span>,</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">2000</span>, <span class="dv">80</span>,</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">3000</span>, <span class="dv">40</span>,</span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a>                      <span class="dv">4000</span>, <span class="dv">20</span>)</span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a><span class="do">## 2. 정규분포 -------------</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> <span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">180</span>)), <span class="fu">aes</span>(x)) <span class="sc">+</span></span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 1,000원 ------</span></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">120</span>, <span class="at">sd =</span> <span class="dv">15</span>)) <span class="sc">+</span> </span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">120</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>) <span class="sc">+</span>  </span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 2,000원 ------</span></span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">80</span>, <span class="at">sd =</span> <span class="dv">10</span>), <span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">80</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span>  </span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 3,000원 ------  </span></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">40</span>, <span class="at">sd =</span> <span class="dv">7</span>), <span class="at">color=</span><span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">40</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span>  </span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>  <span class="do">## 가격 4,000원 ------  </span></span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_function</span>(<span class="at">fun =</span> dnorm, <span class="at">n =</span> <span class="dv">101</span>, </span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>                <span class="at">args =</span> <span class="fu">list</span>(<span class="at">mean =</span> <span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">5</span>), <span class="at">color=</span><span class="st">"orange"</span>) <span class="sc">+</span>  </span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span><span class="dv">20</span>, <span class="at">y=</span><span class="dv">0</span>), <span class="at">size =</span><span class="dv">3</span>, <span class="at">color =</span> <span class="st">"orange"</span>) <span class="sc">+</span>  </span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"가격별 예상판매 커피수 확률분포"</span>,</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>       <span class="at">x =</span> <span class="st">"커피 판매량 (단위: 컵)"</span>,</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">""</span>) <span class="sc">+</span></span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">120</span>, <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"1천원"</span>), <span class="at">color =</span> <span class="st">"black"</span>) <span class="sc">+</span></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">80</span>,  <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"2천원"</span>), <span class="at">color =</span> <span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">40</span>,  <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"3천원"</span>), <span class="at">color =</span> <span class="st">"blue"</span>) <span class="sc">+</span></span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">20</span>,  <span class="at">y =</span> <span class="fl">0.01</span>, <span class="at">label =</span> <span class="st">"4천원"</span>), <span class="at">color =</span> <span class="st">"orange"</span>) </span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a><span class="fu">## 가격별 커피 판매량</span></span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>가격 변동에 따라 매출이 어떻게 변화하게 되는지 각 분포에서 난수를 추출하여 모의실험을 수행해보자. </span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a>$$ X_{\text{커피 판매량}} \sim \mathcal{N}(\mu,\,\sigma^{2})$$</span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$X_{\text{1천원}} \sim \mathcal{N}(120,\, 15^{2})$</span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$X_{\text{2천원}} \sim \mathcal{N}(80, \, 10^{2})$</span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$X_{\text{3천원}} \sim \mathcal{N}(40, \,  7^{2})$</span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a><span class="ss">- </span>$X_{\text{4천원}} \sim \mathcal{N}(20, \,  5^{2})$</span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a>상기 4가지 가격정책에 대해 1,000개 난수를 추출하여 판매량을 예측해본다.</span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>coffee_quantity <span class="ot">&lt;-</span> <span class="fu">tribble</span>(<span class="sc">~</span><span class="st">"mean"</span>, <span class="sc">~</span><span class="st">"sd"</span>,</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a>        <span class="dv">120</span>, <span class="dv">15</span>,</span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a>        <span class="dv">80</span>, <span class="dv">10</span>,</span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>        <span class="dv">40</span>, <span class="dv">7</span>,</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>        <span class="dv">20</span>, <span class="dv">5</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">price =</span> <span class="fu">case_when</span>(mean <span class="sc">==</span> <span class="dv">120</span> <span class="sc">~</span> <span class="st">"1천원"</span>,</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">80</span> <span class="sc">~</span> <span class="st">"2천원"</span>,</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">40</span> <span class="sc">~</span> <span class="st">"3천원"</span>,</span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">20</span> <span class="sc">~</span> <span class="st">"4천원"</span>))</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data <span class="ot">&lt;-</span> coffee_quantity <span class="sc">%&gt;%</span> </span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(판매량 <span class="ot">=</span> <span class="fu">map2</span>(mean, sd, rnorm, <span class="at">n =</span> <span class="dv">1000</span>) )</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data <span class="sc">%&gt;%</span> </span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(판매량) <span class="sc">%&gt;%</span> </span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> 판매량, <span class="at">fill =</span> <span class="fu">fct_rev</span>(price))) <span class="sc">+</span></span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"가격별 예상판매 모의 커피수"</span>,</span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"커피 판매량 (단위: 컵)"</span>,</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"커피가격"</span>) <span class="sc">+</span></span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a><span class="fu">## 가격별 매출확률분포</span></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a>가격 변화에 따라 판매량이 가격민감도에 따라 차이가 나기 때문에 모의시험을 통해 매출변화를 살펴보면 커피값 2,000원에서 가장 높은 매출이 나타났다. 가격이 4,000원일 때 상대적으로 낮은 매출이 나왔으며 2,000/3,000원에서는 대략 유사한 매출이 관측됐다.</span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a>coffee_quantity_data <span class="sc">%&gt;%</span> </span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(판매량) <span class="sc">%&gt;%</span> </span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(가격 <span class="ot">=</span> <span class="fu">case_when</span>(mean <span class="sc">==</span> <span class="dv">120</span> <span class="sc">~</span> <span class="dv">1000</span>,</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">80</span> <span class="sc">~</span> <span class="dv">2000</span>,</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">40</span> <span class="sc">~</span> <span class="dv">3000</span>,</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a>                           mean <span class="sc">==</span>  <span class="dv">20</span> <span class="sc">~</span> <span class="dv">4000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(매출 <span class="ot">=</span> 가격 <span class="sc">*</span> 판매량 <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> 매출, <span class="at">fill =</span> <span class="fu">as.factor</span>(가격))) <span class="sc">+</span></span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">position =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"일일 가격별 예상매출 모의시험 결과"</span>,</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>         <span class="at">x =</span> <span class="st">"커피 매출 (단위: 만원)"</span>,</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a>         <span class="at">y =</span> <span class="st">""</span>,</span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>         <span class="at">fill =</span> <span class="st">"커피가격"</span>) <span class="sc">+</span></span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"top"</span>)</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a><span class="fu"># 톰슨 샘플링</span></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>톰슨 샘플링(Thompson sampling)은 1933년 톰슨이 최초 기술되었으나 Multi-Armed Bandit 문제를 통해 다시 부각되기 시작했다. </span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>서로 다른 가격정책을 취하는 커피점 3개가 있다고 가정하자. 커피 만족도는 다양한 요인이 고객의 만족도에 영향을 준다. 대체로 커피점 C가 만족도가 가장 높은 것으로 나오나 일자별로 살펴보면 평균적으로 A커피점이 B커피점 보다 낮은 만족도를 주고 있으나 날씨, 매장 상황 등 여러 요인으로 인해 A커피점이 B커피점보다 더 높은 만족도를 주는 경우도 있다. </span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a>커피점 3 곳에 경쟁하고 있고 각 커피점이 주는 고객 만족도가 서로 다른 확률분포를 따른다고 가정했을 때 처음 이사를 온 김모씨는 처음 몇일 동안 탐색기간을 가지게 되고 어느 정도 탐색기간이 끝나게 되면 더이상의 탐색은 하지 않고 김모씨 본인의 효용을 극대화하기 위해 특정 커피점만 이용하는 행태를 갖게 된다. 이를 시각적으로 표현하면 다음과 같다.</span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a><span class="al">![](images/thompson-sampling.png)</span></span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a><span class="fu">## 최고의 맛집</span></span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a>커피집 3곳에 동시에 오픈을 했는데 100명이 커피집을 골고루 방문한 후에 만족한 고객숫자와 불만족한 고객숫자를 다음과 같이 설정하고 10 영업일 기준 최고맛집을 선정할 수 있다. 먼저 베타분포에서 각 커피점 방문 고객 만족자수와 불만족 고객수를 형태모수로 넣어 10 영업일 기준 최고의 맛집을 선정한다.</span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피점 방문 숫자</span></span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a>beta_visits <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">100</span>, <span class="dv">100</span>)</span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피집 만족 고객수</span></span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a>beta_success <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">15</span>)</span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피집 불만족 고객수</span></span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>beta_failure <span class="ot">&lt;-</span> beta_visits <span class="sc">-</span> beta_success</span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>num_shops <span class="ot">&lt;-</span> <span class="fu">length</span>(beta_visits)</span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a><span class="co"># 영업일수</span></span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a>num_days <span class="ot">&lt;-</span> <span class="dv">10</span> </span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a><span class="co"># 베타분포 (성공, 실패) 하루 영업일</span></span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>one_day_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"A커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">1</span>]),</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"B커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">2</span>]),</span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a>                      <span class="st">"C커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">3</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">3</span>]))</span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a><span class="co"># tibble(beta_success, beta_failure) %&gt;% </span></span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a><span class="co">#   mutate(data = map2_dbl(beta_success, beta_failure, rbeta, n=1))</span></span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a><span class="co"># 베타분포 (성공, 실패) N 영업일</span></span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>num_days) {</span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>  one_day_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="st">"A커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">1</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">1</span>]),</span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"B커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">2</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">2</span>]),</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a>                        <span class="st">"C커피점"</span> <span class="ot">=</span> <span class="fu">rbeta</span>(<span class="dv">1</span>, <span class="dv">1</span><span class="sc">+</span>beta_success[<span class="dv">3</span>], <span class="dv">1</span><span class="sc">+</span>beta_failure[<span class="dv">3</span>]))</span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a>  coffee_tbl <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(coffee_tbl, one_day_tbl)</span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a><span class="co"># 커피집 선정</span></span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(오늘의맛집 <span class="ot">=</span> <span class="fu">max.col</span>(coffee_tbl)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(오늘의맛집 <span class="ot">=</span> <span class="fu">factor</span>(오늘의맛집, <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"A커피점"</span>, <span class="st">"B커피점"</span>, <span class="st">"C커피점"</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(오늘의맛집) <span class="sc">%&gt;%</span> </span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(선정횟수 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(선정비율 <span class="ot">=</span> 선정횟수 <span class="sc">/</span> <span class="fu">sum</span>(선정횟수))</span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a><span class="fu">## 커피집 선정과정</span></span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>톰슨 샘플링을 통해 커피집 선정과 가격결정 등 주요 의사결정에 있어 장점은 자기수정기능이 있다는 점이다. 예를 들어, 매월 커피집 선정과 가격절정 등 수집된 실증 사업데이터를 자동갱신하여 사업을 계속할 수 있다.</span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a>예를 들어, 다음과 같이 서로 다른 세가지 특성(다른 조건은 동일하고 가격이 다소 다른 커피집)을 갖는 취하는 커피집이 있다고 하면 미세한 차이가 나지만 이러한 작은 차이가 매월매월 지나면서 방문자수에서 차이가 나고 사업의 성패를 좌우하게 됩니다.</span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>베르누이 밴딧을 상정하고 톰슨 샘플링을 구현한 의사코드는 다음과 같다. 형태모수 $\alpha, \beta$를 베타분포에서 보통 $\alpha=1, \beta=1$로 지정하여 균등분포로 두고 성공과 실패를 고객의 방문, 온라인광고의 경우 노출시 클릭여부로 두고 알고리즘 전반을 설정한다. 그리고 나서 K개 커피집(여기서는 3개)에 대해 T명 지나가는 행인(여기서는 100명)을 반복하는 난수를 베타분포에서 추출한다. 이후 가장 많은 방문을 갖는 커피집을 선정하고 나서 성공과 실패를 갱신한다. </span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a><span class="co">[</span><span class="ot">의사 알고리즘 이미지 출처: [카카오 AI추천 : 토픽 모델링과 MAB를 이용한 카카오 개인화 추천](https://tech.kakao.com/2021/06/25/kakao-ai-recommendation-01/)</span><span class="co">]</span>{.aside}</span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a><span class="al">![톰슨 샘플링 의사코드](images/thompson_pseudo_code.png)</span></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a><span class="co">#| eval: false</span></span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">77777</span>)</span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a><span class="do">## 설정 --------------------</span></span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>coffee_tbl <span class="ot">&lt;-</span> {}</span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>success_prob <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.10</span>, <span class="fl">0.11</span>, <span class="fl">0.15</span>)</span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>beta_visits  <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(success_prob))</span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a>beta_success <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="fu">length</span>(success_prob))</span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a>num_shops  <span class="ot">&lt;-</span> <span class="fu">length</span>(success_prob)</span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>visits_size <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a><span class="do">## 1개월 영업 -------------------</span></span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a>get_monthly_prob <span class="ot">&lt;-</span> <span class="cf">function</span>(beta_visits, beta_success) {</span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a>  monthly_coffee <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 영업일 100명 기준 일별 커피집 방문</span></span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>) {</span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 고객 커피집 선택 난수생성</span></span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a>    user_prob_tbl <span class="ot">&lt;-</span> <span class="fu">tibble</span>(beta_success, beta_visits) <span class="sc">%&gt;%</span></span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">beta_failure =</span> beta_visits <span class="sc">-</span> beta_success) <span class="sc">%&gt;%</span> </span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">map2_dbl</span>(beta_success<span class="sc">+</span><span class="dv">1</span>, beta_failure<span class="sc">+</span><span class="dv">1</span>, rbeta, <span class="at">n =</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">data =</span> <span class="fu">ifelse</span>(<span class="fu">is.finite</span>(data), data, <span class="dv">0</span> )) <span class="sc">%&gt;%</span></span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">shops =</span> <span class="fu">c</span>(<span class="st">"A커피집"</span>, <span class="st">"B커피집"</span>, <span class="st">"C커피집"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>      <span class="fu">select</span>(shops, data) <span class="sc">%&gt;%</span> </span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a>      <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> shops, <span class="at">values_from =</span> data, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a>    monthly_coffee <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(monthly_coffee, user_prob_tbl)</span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a>  <span class="co"># daily_coffee</span></span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 영업일 100명 기준 방문 실적 업데이트</span></span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a>  updated_prob <span class="ot">&lt;-</span> monthly_coffee <span class="sc">%&gt;%</span> </span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(오늘의맛집 <span class="ot">=</span> <span class="fu">max.col</span>(monthly_coffee)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a>    <span class="co"># mutate(오늘의맛집 = factor(오늘의맛집, </span></span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a>    <span class="co">#                       labels = c("A커피점", "B커피점", "C커피점"))) %&gt;% </span></span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(오늘의맛집) <span class="sc">%&gt;%</span> </span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarise</span>(선정횟수 <span class="ot">=</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(선정확률 <span class="ot">=</span> 선정횟수 <span class="sc">/</span> <span class="fu">sum</span>(선정횟수, <span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pull</span>(선정확률)</span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a>  updated_prob</span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a><span class="fu">get_monthly_prob</span>(beta_success, beta_visits)</span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a><span class="do">## 12개월 영업 -------------------</span></span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) { <span class="co"># 12개월</span></span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 매월 커피집 방문 확률 반영</span></span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a>  updated_prob <span class="ot">&lt;-</span> <span class="fu">get_monthly_prob</span>(beta_visits, beta_success)</span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 월별 가중치 변경</span></span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a>  weights <span class="ot">&lt;-</span> <span class="fu">round</span>(updated_prob <span class="sc">*</span> visits_size, <span class="dv">0</span>)</span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 커피구매 고객수 수정 반영</span></span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>  beta_success <span class="ot">&lt;-</span> beta_success <span class="sc">+</span> <span class="fu">rbinom</span>(<span class="fu">rep</span>(<span class="dv">1</span>, num_shops), <span class="at">size =</span> weights,</span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">prob =</span> success_prob)</span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 전체 고객 방문고객수 반영</span></span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a>  beta_visits <span class="ot">&lt;-</span> beta_visits <span class="sc">+</span> weights</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 월별 커피집 방문확률 누적</span></span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a>  coffee_tbl <span class="ot">&lt;-</span> <span class="fu">rbind</span>(coffee_tbl, <span class="fu">t</span>(<span class="fu">matrix</span>(updated_prob)))</span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="ot">&lt;-</span> coffee_tbl <span class="sc">%&gt;%</span> </span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a>  <span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a>  <span class="fu">set_names</span>(<span class="fu">c</span>(<span class="st">"A커피점"</span>, <span class="st">"B커피점"</span>, <span class="st">"C커피점"</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(월별 <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span>월별, <span class="at">names_to =</span> <span class="st">"커피점"</span>, <span class="at">values_to =</span> <span class="st">"방문확률"</span>)</span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="sc">%&gt;%</span> </span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_rds</span>(<span class="st">"data/coffee_tbl_rds.rds"</span>)</span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a>상기 커피집 방문확률을 월별로 나눠 쭉 지켜보게 되면 다음과 같이 처음에는 A, B 커피집이 우세하지만 시간이 지나면서 고객은 C 커피집 선택이 확대되는 것을 확인할 수 있다. </span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a><span class="in">```{r}</span></span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="ot">&lt;-</span> </span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>  <span class="fu">read_rds</span>(<span class="st">"data/coffee_tbl_rds.rds"</span>)</span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a>coffee_tbl_rds <span class="sc">%&gt;%</span> </span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">as.factor</span>(월별), <span class="at">y =</span> 방문확률, <span class="at">fill =</span> 커피점)) <span class="sc">+</span> </span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_col</span>() <span class="sc">+</span></span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">"월"</span>,</span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a>         <span class="at">title =</span> <span class="st">"월별 고객 커피점 방문확률 예측"</span>) <span class="sc">+</span></span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a><span class="in">```</span></span>
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div></div></div></div></div>
</div> <!-- /content -->
<script>var lightboxQuarto = GLightbox({"openEffect":"zoom","selector":".lightbox","descPosition":"bottom","closeEffect":"zoom","loop":true});</script>



</body></html>